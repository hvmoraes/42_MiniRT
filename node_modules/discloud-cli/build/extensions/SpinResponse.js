"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const node_process_1 = require("node:process");
function default_1(toolbox) {
    toolbox.print.spinApiRes = function (apiRes, spin, options) {
        if (!spin)
            return toolbox.print.printApiRes(apiRes, options);
        if (typeof apiRes.data === "string") {
            apiRes.data = apiRes.data.match(/<title>(.*)<\/title>/)?.[1] ?? apiRes.data;
            spin.info(`[DISCLOUD API] ${apiRes.data}`);
        }
        if (apiRes.status > 399) {
            spin.fail(toolbox.print.colors.red(`[DISCLOUD API: ${apiRes.status}] ${apiRes.data?.message ?? apiRes.originalError ?? "fail!"}`));
            return options?.exitOnError ? (0, node_process_1.exit)(apiRes.status) : apiRes.status;
        }
        if (apiRes.data)
            if (apiRes.data.status === "ok") {
                spin.succeed(toolbox.print.colors.green(`[DISCLOUD API] ${apiRes.data.message ?? apiRes.originalError ?? "success!"}`));
            }
            else {
                spin.warn(toolbox.print.colors.yellow(`[DISCLOUD API] ${apiRes.data.message ?? apiRes.originalError ?? "warn!"}`));
            }
        if (apiRes.problem) {
            spin.fail(`[${apiRes.problem}: ${apiRes.originalError?.errno}] ${apiRes.originalError ?? "fail!"}`);
            return options?.exitOnError ? (0, node_process_1.exit)(apiRes.originalError?.errno) : apiRes.originalError?.errno;
        }
        if (spin.isSpinning)
            spin.stop();
        return apiRes.status;
    };
}
exports.default = default_1;
