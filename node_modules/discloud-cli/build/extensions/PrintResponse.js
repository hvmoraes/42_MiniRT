"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const node_process_1 = require("node:process");
function default_1(toolbox) {
    toolbox.print.printApiRes = function (apiRes, options, spin) {
        if (spin)
            return toolbox.print.spinApiRes(apiRes, spin, options);
        if (typeof apiRes.data === "string") {
            apiRes.data = apiRes.data.match(/<title>(.*)<\/title>/)?.[1] ?? apiRes.data;
            toolbox.print.info(`[DISCLOUD API] ${apiRes.data}`);
        }
        if (apiRes.status > 399) {
            toolbox.print.error(`[DISCLOUD API: ${apiRes.status}] ${apiRes.data?.message ?? apiRes.originalError ?? "fail!"}`);
            return options?.exitOnError ? (0, node_process_1.exit)(apiRes.status) : apiRes.status;
        }
        if (apiRes.data)
            if (apiRes.data.status === "ok") {
                toolbox.print.success(`[DISCLOUD API] ${apiRes.data.message ?? apiRes.originalError ?? "success!"}`);
            }
            else {
                toolbox.print.warning(`[DISCLOUD API] ${apiRes.data.message ?? apiRes.originalError ?? "warn!"}`);
            }
        if (apiRes.problem) {
            toolbox.print.error(`[${apiRes.problem}: ${apiRes.originalError?.errno}] ${apiRes.originalError ?? "fail!"}`);
            return options?.exitOnError ? (0, node_process_1.exit)(apiRes.originalError?.errno) : apiRes.originalError?.errno;
        }
        return apiRes.status;
    };
}
exports.default = default_1;
