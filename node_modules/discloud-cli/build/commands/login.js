"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const v2_1 = require("@discloudapp/api-types/v2");
const util_1 = require("../util");
exports.default = {
    name: "login",
    description: "Login to Discloud API.",
    async run(toolbox) {
        const { print, prompt } = toolbox;
        if (util_1.RateLimit.isLimited)
            return print.error(`Rate limited until: ${util_1.RateLimit.limited}`);
        const { token } = await prompt.ask({
            name: "token",
            message: "Your discloud token:",
            type: "password",
        });
        const apiRes = await util_1.apidiscloud.get(v2_1.Routes.user(), {}, {
            headers: {
                "api-token": token,
            },
        });
        new util_1.RateLimit(apiRes.headers);
        print.printApiRes(apiRes, { exitOnError: true });
        if (apiRes.data?.status === "ok")
            util_1.config.update({ token });
    },
};
